<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>International iBCI Patient Registry</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- Google Fonts: Using Lora for headings and Inter as a fallback -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600&family=Inter:wght@300;400;500;700&display=swap"
    rel="stylesheet"
  />

  <!-- Inline CSS -->
  <style>
    /* =============== BASE RESET & GLOBAL STYLES =============== */
    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
      scroll-behavior: smooth;
      overscroll-behavior: none;
      font-size: 16px;
      line-height: 1.4;
      font-family: "Inter", "Söhne", sans-serif;
      background-color: #FCFBE8; /* Muted background */
      color: #373737;
      -webkit-font-smoothing: antialiased;
      display: flex;
      flex-direction: column;
    }

    /* Headings use Lora */
    h1, h2, h3, h4, h5, h6 {
      font-family: "Lora", serif;
      margin: 0.8em 0 0.4em;
      font-weight: 600;
      color: #373737;
    }

    a {
      color: #373737;
      text-decoration: underline;
      text-underline-offset: 0.3em;
    }

    /* Container */
    .container {
      width: 90%;
      max-width: 1200px;
      margin: 0 auto;
      padding-top: 1rem;
      padding-bottom: 1rem;
      flex: 1;
    }

    /* =============== NAVBAR =============== */
    .navbar {
      background: #FCFBE8;
      border-bottom: 1px solid #373737;
      padding: 0.8rem;
    }
    .navbar h1 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 600;
    }

    /* =============== SUMMARY BAR =============== */
    .summary-alert {
      background: #fff;
      border: 1px solid #373737;
      color: #373737;
      font-weight: 500;
      text-align: center;
      padding: 0.5rem 1rem;
      margin-bottom: 1.5rem;
    }

    /* =============== SEARCH INPUT =============== */
    .search-bar {
      display: flex;
      justify-content: center;
      margin-bottom: 1rem;
    }
    .search-bar input {
      width: 100%;
      max-width: 500px;
      padding: 0.6rem;
      border: 1px solid #373737;
      font-size: 0.95rem;
      color: #373737;
      background: #fff;
    }
    .search-bar input::placeholder {
      color: #999;
    }

    /* =============== TABLE =============== */
    .table-container {
      overflow-x: auto;
      background: #fff;
      border: 1px solid #373737;
      margin-bottom: 2rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
    }
    thead {
      background: #f5f5f5;
      border-bottom: 2px solid #373737;
    }
    th, td {
      text-align: left;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #ddd;
      vertical-align: middle;
    }
    th {
      font-weight: 600;
      font-family: "Lora", serif;
      color: #373737;
      cursor: pointer;
      user-select: none;
    }
    th .sort-indicator {
      margin-left: 0.5rem;
      font-size: 0.8rem;
    }
    tbody tr:hover {
      background: #fafafa;
    }

    /* =============== FOOTER =============== */
    footer.footer {
      background: #FCFBE8;
      border-top: 1px solid #373737;
      text-align: center;
      padding: 0.5rem;
      font-size: 0.9rem;
      margin-top: auto;
    }
    footer.footer p {
      margin: 0;
      font-weight: 300;
    }

    /* =============== RESPONSIVE =============== */
    @media (max-width: 600px) {
      .summary-alert {
        font-size: 0.95rem;
      }
      th, td {
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="container" style="border: none; padding: 0;">
      <h1>International iBCI Patient Registry</h1>
    </div>
  </nav>

  <!-- Main content -->
  <div class="container">
    <!-- Summary Alert -->
    <div class="summary-alert">
      <strong>Total number of patients implanted with an iBCI: 80</strong>
    </div>

    <!-- Search Bar -->
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search by any field..." onkeyup="filterTable()" />
    </div>

    <!-- Table Container -->
    <div class="table-container">
      <table id="ibciTable">
        <thead>
          <tr>
            <th onclick="sortTable('year')">Year of Implant <span id="sortIndicator-year" class="sort-indicator"></span></th>
            <th onclick="sortTable('patientID')">Patient ID <span id="sortIndicator-patientID" class="sort-indicator"></span></th>
            <th onclick="sortTable('institution')">Institution / Center <span id="sortIndicator-institution" class="sort-indicator"></span></th>
            <th onclick="sortTable('deviceType')">Device Type <span id="sortIndicator-deviceType" class="sort-indicator"></span></th>
            <th onclick="sortTable('sex')">Sex <span id="sortIndicator-sex" class="sort-indicator"></span></th>
            <th onclick="sortTable('age')">Age at Implant <span id="sortIndicator-age" class="sort-indicator"></span></th>
            <th onclick="sortTable('etiology')">Etiology of Paralysis <span id="sortIndicator-etiology" class="sort-indicator"></span></th>
            <th onclick="sortTable('tasks')">Tasks Performed <span id="sortIndicator-tasks" class="sort-indicator"></span></th>
            <th onclick="sortTable('publications')">Publications <span id="sortIndicator-publications" class="sort-indicator"></span></th>
          </tr>
        </thead>
        <tbody id="ibciTableBody">
          <!-- Rows will be inserted here via JavaScript -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <p>Created by Jamie Brannigan and Esmee Dohle</p>
  </footer>

  <!-- In-line JavaScript -->
  <script>
    // Global sort state variables
    let currentSortKey = "year";
    // For "year", default is descending (most recent first); for others, default ascending.
    let currentSortDirection = -1; 

    // Example Data – note that additional fields have been added.
    const ibciPatients = [
      {
        year: 2021,
        patientID: "P3",
        institution: "Synchron Center, Melbourne",
        deviceType: "Endovascular Stentrode",
        sex: "Male",
        age: 40,
        etiology: "Spinal Cord Injury",
        tasks: "Robotic arm control, digital tasks",
        publications: [
          { display: "Oxley et al, 2021", link: "https://jnis.bmj.com/content/13/2/102" }
        ]
      },
      {
        year: 2016,
        patientID: "P2",
        institution: "Grenoble University Hospital",
        deviceType: "ECoG Grid",
        sex: "Female",
        age: 50,
        etiology: "Stroke",
        tasks: "Communication, target selection",
        publications: [
          { display: "Vansteensel et al, 2016", link: "https://www.nejm.org/doi/10.1056/NEJMoa1608085" }
        ]
      },
      {
        year: 2020,
        patientID: "P1",
        institution: "BrainGate Consortium (John Radcliffe Hospital)",
        deviceType: "Utah Array",
        sex: "Male",
        age: 45,
        etiology: "Amyotrophic Lateral Sclerosis",
        tasks: "Cursor control, typing",
        publications: [
          { display: "Hochberg et al, 2006", link: "https://www.nature.com/articles/nature07479" },
          { display: "Brandman et al, 2018", link: "https://elifesciences.org/articles/18554" }
        ]
      }
      // Additional records can be added here.
    ];

    // When the page loads, sort the data by default and populate the table.
    window.onload = function() {
      sortData(currentSortKey, currentSortDirection);
      populateTable();
      updateSortIndicators();
    };

    // Function to sort the ibciPatients array.
    function sortData(key, direction) {
      ibciPatients.sort((a, b) => {
        let valA = a[key];
        let valB = b[key];

        // For the "publications" column, sort by the first publication's display text.
        if (key === "publications") {
          valA = (a.publications && a.publications.length) ? a.publications[0].display : "";
          valB = (b.publications && b.publications.length) ? b.publications[0].display : "";
        }

        // If sorting by year, implement a secondary sort by institution (alphabetically ascending).
        if (key === "year") {
          if (valA === valB) {
            let instA = a.institution.toLowerCase();
            let instB = b.institution.toLowerCase();
            return instA.localeCompare(instB) * 1;
          }
        }

        // Determine if the value is numeric.
        if (typeof valA === "number" && typeof valB === "number") {
          return (valA - valB) * direction;
        } else {
          // Convert to string and compare case-insensitively.
          valA = String(valA).toLowerCase();
          valB = String(valB).toLowerCase();
          return valA.localeCompare(valB) * direction;
        }
      });
    }

    // Called when a header is clicked to sort by a given key.
    function sortTable(key) {
      // If the column is already sorted, toggle direction; otherwise, set new key.
      if (currentSortKey === key) {
        currentSortDirection = -currentSortDirection;
      } else {
        currentSortKey = key;
        // Default sort direction: for year use descending (-1), otherwise ascending (1)
        currentSortDirection = (key === "year") ? -1 : 1;
      }
      sortData(currentSortKey, currentSortDirection);
      populateTable();
      updateSortIndicators();
    }

    // Update sort indicators (simple arrow icons) in header cells.
    function updateSortIndicators() {
      // List of sort keys matching our header IDs.
      const sortKeys = ["year", "patientID", "institution", "deviceType", "sex", "age", "etiology", "tasks", "publications"];
      sortKeys.forEach(key => {
        const indicator = document.getElementById("sortIndicator-" + key);
        if (key === currentSortKey) {
          indicator.textContent = currentSortDirection === 1 ? "▲" : "▼";
        } else {
          indicator.textContent = "";
        }
      });
    }

    // Populate the table body with the current ibciPatients array.
    function populateTable() {
      const tbody = document.getElementById("ibciTableBody");
      tbody.innerHTML = "";

      ibciPatients.forEach(patient => {
        const row = document.createElement("tr");

        // Create cells for each column.
        const createCell = (text) => {
          const cell = document.createElement("td");
          cell.textContent = text;
          return cell;
        };

        // Year of Implant
        row.appendChild(createCell(patient.year));
        // Patient ID
        row.appendChild(createCell(patient.patientID));
        // Institution / Center
        row.appendChild(createCell(patient.institution));
        // Device Type
        row.appendChild(createCell(patient.deviceType));
        // Sex
        row.appendChild(createCell(patient.sex));
        // Age at Implant
        row.appendChild(createCell(patient.age));
        // Etiology
        row.appendChild(createCell(patient.etiology));
        // Tasks Performed
        row.appendChild(createCell(patient.tasks));
        
        // Publications: display each as "Author et al, Year" separated by a line break.
        const pubCell = document.createElement("td");
        if (patient.publications && patient.publications.length > 0) {
          // For each publication, create a link.
          const pubItems = patient.publications.map(pub => {
            // Create an anchor element.
            const a = document.createElement("a");
            a.href = pub.link;
            a.target = "_blank";
            a.rel = "noopener noreferrer";
            a.textContent = pub.display;
            return a.outerHTML;
          });
          // Join with <br> for a compact display.
          pubCell.innerHTML = pubItems.join("<br>");
        } else {
          pubCell.textContent = "N/A";
        }
        row.appendChild(pubCell);

        tbody.appendChild(row);
      });
    }

    // Filter table rows based on search input.
    function filterTable() {
      const input = document.getElementById("searchInput");
      const filter = input.value.toLowerCase();
      const tbody = document.getElementById("ibciTableBody");
      const rows = tbody.getElementsByTagName("tr");

      for (let i = 0; i < rows.length; i++) {
        const row = rows[i];
        const cells = row.getElementsByTagName("td");
        let match = false;
        for (let j = 0; j < cells.length; j++) {
          if (cells[j].textContent.toLowerCase().indexOf(filter) > -1) {
            match = true;
            break;
          }
        }
        row.style.display = match ? "" : "none";
      }
    }
  </script>
</body>
</html>



